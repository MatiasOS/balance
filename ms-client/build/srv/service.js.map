{"version":3,"sources":["../../srv/service.js"],"names":["config","process","env","BOILER_TAG","BOILER_HOST","BOILER_BASES","BOILER_MONGO_URI","BOILER_REDIS_TIMEOUT","console","log","exit","tag","dbname","host","bases","split","mongoUri","timeout","BOILER_TIMEOUT","silent","NODE_ENV","pin","opts","seneca","internal","logger","debug","short_logs","transport","web","mesh","sneeze","mongo","uri","use","ready","id","act","role","cmd","target","err","result","data"],"mappings":"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","file":"service.js","sourcesContent":["/**\n * @module\n */\nimport Seneca from 'seneca'\nimport dotenv from 'dotenv'\nimport logger from 'seneca-demo-logger'\nimport async from 'async'\n\ndotenv.config()\n\nif (!process.env.BOILER_TAG ||\n  !process.env.BOILER_HOST ||\n  !process.env.BOILER_BASES ||\n  !process.env.BOILER_MONGO_URI ||\n  !process.env.BOILER_REDIS_TIMEOUT) {\n  console.log(`You must set:\n        BOILER_HOST \n        BOILER_BASES \n        BOILER_MONGO_URI \n        BOILER_REDIS_TIMEOUT `)\n\n  process.exit(-1)\n}\nconst tag = process.env.BOILER_TAG\nconst dbname = process.env.BOILER_TAG\nconst host = process.env.BOILER_HOST\nconst bases = process.env.BOILER_BASES.split(',')\nconst mongoUri = `${process.env.BOILER_MONGO_URI}/${dbname}`\nconst timeout = process.env.BOILER_TIMEOUT || 20000\nconst silent = process.env.NODE_ENV === 'production'\n\nconst pin = `role:${tag}`\n\nconst opts = {\n  seneca: {\n    tag: tag,\n    internal: {logger: logger},\n    debug: {short_logs: true},\n    transport: {\n      web: {\n        timeout\n      }\n    }\n  },\n  mesh: {\n    pin,\n    bases,\n    host,\n    sneeze: {\n      silent\n    }\n  },\n  mongo: {\n    uri: mongoUri\n  }\n}\n\nSeneca(opts.seneca)\n  .use('mesh', opts.mesh)\n  .ready( () => {\n    console.log(this.id)\n    this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n      (err, result) => {\n        console.log(result.data)\n        this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n          (err, result) => {\n            console.log(result.data)\n            this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n              (err, result) => {\n                console.log(result.data)\n                this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                  (err, result) => {\n                    console.log(result.data)\n                    this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                      (err, result) => {\n                        console.log(result.data)\n                        this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                          (err, result) => {\n                            console.log(result.data)\n                            this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                              (err, result) => {\n                                console.log(result.data)\n                                this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                                  (err, result) => {\n                                    console.log(result.data)\n                                    this.act({role: 'ms-worker', cmd: 'process', target: 'msg'},\n                                      (err, result) => {\n                                        console.log(result.data)\n\n                                      })\n                                  })\n                              })\n                          })\n                      })\n                  })\n              })\n          })\n      })\n  })\n\n\n"]}